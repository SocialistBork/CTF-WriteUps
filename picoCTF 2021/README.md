# PicoCTF 2021
Ctf At: https://play.picoctf.org/

## Scrambled:RSA
### Chalenge Descirption
Hmmm I wonder if you have learned your lesson... Let's see if you understand RSA and how the encryption works. Connect with nc mercury.picoctf.net 4572.

Initial Output:
```
flag: 3265207610760244207318185018049873647588298156347486822800103136725732956641105458134626631158003882948838756620213083202957253041267391330769175562759919047786214401774912861214734579670738918229311041605518620249983536373496887218686166624950237466159718634185655994852117104518018304785686552037313206562066043924408786102462116698855281703427908108584501417231511672063428502510298962975332156111153348333768298042731837428139537588169857914694769429742333023999104392063346386739416435127221075959983558723503077215711971475867193899519651826904160052976511819375307084709122850264353791073315350607608511970948407853824316550822150708885729729933947824168195285003037839987347200623045566965246513550416698899554373924161622812545018304972652387141047381629222660880353492062387066486285733883544893932924657609627166734922738310615962244502174300936267606742978325739947087609227772272541701622574798090127733223397941438640823457882486213573094907179219648191599299616768881298268360052270530512559158473170564210576016620400188886724599095647601738536305921461390798839239840644668912285990828979916483529569273069274175459484164564281158905995008509535302252307722406656642627671213452623489290216720403101269115341501297995168879809298171114662213415224615550747198677584486340125227512016120643368017873078227644335226515635395304101102371640488824413726899798809571602117073812087289354328336426755699819565417179719939096293675343274860277716558676752561271849322455714430648154967660365222674336936669931770524276889539519074812109154032602953947869669381103635725935431424910947193936773945759725919275372815821939141841530378351629525156692779056620375114870563716886711653034110340001240727909333316325847958882203231839839780560918025432371189665784280202946632626895183601614086261229279309595794794609237164096734666537441751355921042544183676873130120157637368748753003750601141605632952747248937317215091902213190192119300762866397984528151495535755994374327346004887875971492168730694958433736450525992241032358917985500529493590746055603036760918337299101656366302446108324387898497589540166618162553110777570029023484507203659644780140646367896031286963798501819650431323941938590027821929383744899047766950661622147248072617589183764997997390620489990758465903844987764562109789634608972432754005774069951986262107730614603627510672769190939568632433865202534404313763765114354595905043619683058994722105008590839069811522137504144903157221112306363036270593349162622853593408771023351074509343430354096986951554413185597806392268893310057827497807138987004028734217745035932760309844089404607075351730551545997772183035007141513219820196380092099310534915494567728654904944344594791970583726413124343725692089880702980194769312907546143399250206199100095272715464555326761545740717118306148985902982432387123920791469709210792539044133894747185558931144685230991535623790706290267678203085963733626994679944253673840213277785006122639535654862192681036740407663416707731659892254961230074815627436066131826914725305178294704706903011303360009830234239354787595626027469591924676487250844494352782495200327165062727286921808305455973204106607395864358955965705345521083846048045273255564975783373702366328444170473598592384078394196248575199620517641755777731150697385495469751943956961728423207552920571568052612548790192588984715030146255186036191658071205637435921241439624431202720189484719312880572671355509295790453922678268801673370370187484536930000813835083013412776166065460384964108680712011376298761055421106117110030474259619226256867086772994546768708848375341880537645685587646061808425101325045504130073466775491564522003017102059056531161501765192433875343143199420252679540323025830795441264268331541335347745970290076432059461710034326631096606138826902773513013598815405216049242722008648644893236865689932190581789013002728700896163198118358737126531196479457673092010965322044782555032416458499239346326305100251361902660764406695337414225880342712553625554818696318854881523829841465306451834881485002984822022175193663750078320311507565312575038869562988972437187306084611116426377004481206464522737170060283466742164013207220200689950082715255686853405159479861407527538061397275502905936910345151673661767217070508455607422165005277630693837078011993608896670330415731135148440921137650357887669271423324654042155792069929749798846309467372269807896608505012399581400744741023418087495865790163532592771210496700564261436190067989581733624465312457864485760048006682726599262164986795164911515131564569865212504843243975907612094091878819764435830765464744400746198189256790018393126247497813390841916121243746991545732575049411464750145334787058777884992904333247950736118025059612931301022713500993642894604922256866172807961641985492990120327395019619400064699768625584349016604921278299903565235549281677333340929454304429531020479364512842196110880897804826906341713294637144059957534743094372400262890909554664538408192088071408411113816007520147953238175016706517468857350794862198364010053101531338137196107114216057434778794398166676587649105064666873263249457614101067964038459532377268733963428256409280945728149644554551406284226944879061502953765712423914191563841813761634560280151735392464803914310175846667941852828090086689238179665072047084121221856417186197176247822525427889258322692281292170930178460386524057673175585558073665654476258654550621079289555008882433333846287919094380693545690384212495344882441128608654585878670553841298422827324700876935145619140089244447452775395354339202935582481762315566655664132519226008042797314982376086530442394646543557317986830704808398187271714997405835584147553541099076471008557428194096729302875931421012808755301305727296135604364755878461752152280350865745365147937016421535135279325236398821722183253314115110748888127829947356837110079215858717997375984722124094181284143061289496996278798234773243700731805140350558073590955956080278890036538919423511385725319540378352222819982605056100048069298428986772431632026929528684729420878434285811764669032284083041422315676356336555291985952106011039447353766787048371711709762298839430580748975440329486519148893392786069729399492071017688113469177414748683804391215558882298487708071412441784166281847124261239628710751046333856053276469025313926497703890299180777991140063779180804878539149267381071071398240927819868326976923502507071777671454570088400380532439242424408489578637687852081512487168273153083121989463572657914928708619940523416818604948651216969370610910595580524196291233946336265961122136807639551193553659692481685860497775830811309459477094861136021510110223079155247578744680336850566010578164046800527324858089157702717595835149807979368572225491164313643671016715360387975431089908902635334598476204129238130288912152797661753603049663357469493888147295729396412619478411953491418599016784231795204212621034169946599004266673855086197095576894221617831936648674033474634267800527689537249724482838155178737368474379640471174782792345001474795201092105883058652012165408614953487208647985955012809318781989438329180320249704945133718497956203033108968487762828145405366467011846980429885786306064989592765325213481350701904252933477837857237085995563571854702875503938416461855384716890449380152669419594543366062764328499375168506314896705565047292516430402393453854001619333186359030870167154783707412864407887039185524062668111574990160863251082156267014440433033998362000907710707283650362384710390072447105460264302120707276716367762584350714839464826936193482318663004589401877841712582982201342421055401340855811063619934230808803008469323575367160046223941146714308275419388190314132806199664371272542749154276392319020390402019669719267759888004464555700124335274400609458438168140538440656473375285682240284145429258889710518369890093091692743836391594269025705897822881760555032328042772287427570951012317275673397537574508425320595113125532234121504347454416202229148815566477574261024735770018237444419329
n: 145775826937661908135794603427036764298148431652534860748957970958867647227057243863542968063275325755861467078901682013815680963378979396229705290153620740976041227679025882587950371024621537384593513832665907376304859529400738517083662160819429765323258532017864261341616649121440070803334438027550190096677
e: 65537
```
We run som tests by inputting random letterst:
```
I will encrypt whatever you give me: e
Here you go: 101719885502312197786806608119863253852373014875904581624851653931185495769839355661717419129417269993860870143127515244144101704079041993926706654236915450313369884942455744301180783979871710057921573059767808665507350588954943316999893660832139157245017796794582373389550635537569938820968435640889654887011
I will encrypt whatever you give me: ee 
Here you go: 21141840257591034775536242809878524388033739985339556663870683081948689548571141759879329105327001491683789130686311752690580007935750522143671430025558892537751857819226311161267278599644062969492229591009096566691411476561913551857779641865153420359297603671069251968344696465479114683500846329916413504552101719885502312197786806608119863253852373014875904581624851653931185495769839355661717419129417269993860870143127515244144101704079041993926706654236915450313369884942455744301180783979871710057921573059767808665507350588954943316999893660832139157245017796794582373389550635537569938820968435640889654887011
I will encrypt whatever you give me: eee
Here you go: 101719885502312197786806608119863253852373014875904581624851653931185495769839355661717419129417269993860870143127515244144101704079041993926706654236915450313369884942455744301180783979871710057921573059767808665507350588954943316999893660832139157245017796794582373389550635537569938820968435640889654887011349153536879314987061033295743216815007014739852262658718541528544661830080394575600641577960373112373890937965943401061515446086842699820778088590946396922610751137148185439805641913935101583365383292764551264733557100811510102947050578419396230987874321794322609020045603091845977460919530306017040360077121141840257591034775536242809878524388033739985339556663870683081948689548571141759879329105327001491683789130686311752690580007935750522143671430025558892537751857819226311161267278599644062969492229591009096566691411476561913551857779641865153420359297603671069251968344696465479114683500846329916413504552
I will encrypt whatever you give me: eeee
Here you go: 10171988550231219778680660811986325385237301487590458162485165393118549576983935566171741912941726999386087014312751524414410170407904199392670665423691545031336988494245574430118078397987171005792157305976780866550735058895494331699989366083213915724501779679458237338955063553756993882096843564088965488701121141840257591034775536242809878524388033739985339556663870683081948689548571141759879329105327001491683789130686311752690580007935750522143671430025558892537751857819226311161267278599644062969492229591009096566691411476561913551857779641865153420359297603671069251968344696465479114683500846329916413504552611945309895871229472089756075186311578914871402115692441198520902431020878382239057630747565597069251952290516139475820604220046353232993734626217894344474542199716637589812710414224749063059207137850671501240384968545223928720092309834708842133838052141170012153375380282728564915985657368092650714213934463491535368793149870610332957432168150070147398522626587185415285446618300803945756006415779603731123738909379659434010615154460868426998207780885909463969226107511371481854398056419139351015833653832927645512647335571008115101029470505784193962309878743217943226090200456030918459774609195303060170403600771
```
### Solution
Immdeiately, something seems off. Recall the RSA Encyrption System. The plaintext *m*, public key *e*, and modulus *n* are used to compute for cipher text *c*.

<img src="https://render.githubusercontent.com/render/math?math=c=m^e\pmod n">

Usually in RSA, each letter maps to another letter, making the ciphertext the same length as the plaintext. Here, the cipher text is signifigantly longer then the plaintext.

In addition, we realize that the cipher is just a subsitutuion cipher, where each letter coresponds to a large, distinct number. In this cipher, each index in the inputted string is encoded with a different alogortihm. The sequence of the encrypted message will also be in a random order

From this, we can write a script where:
1. Make a list of possible characters (a - z, A -  Z, 0 - 9, {, }, _)
2. At the 8th index (the index after the picoCTF{ wrapper), we have to isolate out the current index and check if the letter it corresponds to exists in the flag. If so, add it to the known part of the flag
3. Continue until you get to the } (End of the flag wrapper)

Coded Solution:
```python
from pwn import *
from string import printable
import re, sys

# regex pattern to get number in a line
ptrn = re.compile('\d+')

def get_encrypt(r, x):
	r.sendline(x)
	return ptrn.search(str(r.recvline())).group()

# remove previously found  cipher
def removeSeen(enc, input, word):
	s=input
	for key in enc:
		s = s.replace(enc[key], '')
	return s


# Update port number according to your problem
r = remote('mercury.picoctf.net', 50075) 

flag = ptrn.search(str(r.recvline())).group()
# print('flag = ', flag)
r.recvline()
r.recvline()

# start by setting prefix to  'picoCTF{', let it run, then replace with the last found string prefix here
prefix = 'picoCTF{bad_1d3a5_0501970'


enc = {(0,'p'): get_encrypt(r,'p')}

assert enc[(0,'p')] in flag

for i in range(2, len(prefix)+1):
	word = prefix[:i]
	#print(word)
	encrypted = get_encrypt(r, word)
	new_encrypted = removeSeen(enc, encrypted, word)
	assert new_encrypted in flag
	enc[(i,word[-1])] = new_encrypted


ptable = 'abcdefghijklmnopqrstuvwxyz0123456789_-}'


current = prefix

while True:
	for i, c in enumerate(ptable):
		#print(c)
		word = current +c
		result = get_encrypt(r, word)
		result = removeSeen(enc, result, word)

		if result in flag:
			enc[(i,c)] = result
			print(word)
			current = word
			if c == '}':
				print('done')
				sys.exit()
			break
	else:
		print('not found')
		break
```
